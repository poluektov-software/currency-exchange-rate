# Задача на получение курса валют

## Условие

Есть некая система, которая использует курсы валют.

Логика получения курсов валют следующая. Вызывающий код может получить их из кэша, 
из базы данных или из внешнего источника по http. В случае, если курса валют нет в кэше, 
необходимо проверить базу данных, и если в базе данных есть, сохранить в кэш. 
Если в базе данных нет - проверить внешний источник и, при получении, сохранить в базу данных и в кэш.

Необходимо реализовать описанную логику. Предполагается, что она будет использоваться во множестве разных мест.

Функционал отправки запросов, работы с базой данных и с кэшем реализовывать нет необходимости. 
Достаточно сделать заглушки. Иными словами, не нужно реализовывать трудоемкие технические детали. 
Вместо этого важнее выполнить декомпозицию предметной области, написать необходимые классы с реализацией логики.

## Решение

Для решения поставленной задачи хорошо подходит паттерн проектирования Цепочка обязанностей 
(Chain of Responsibility). В нашем случае мы реализуем последовательную цепочку 
Кэш -> База данных -> API, выполнение которой прерывается, если данные получены на 
очередном этапе.

Все компоненты цепи реализуют интерфейс **CurrencySourceInterface**. При необходимости, 
можно расширять цепочку или менять местами источники получения курса валют.

Для упрощения реализации получения курса валют во многих местах приложения, 
применяем паттерн Фасад (Facade). Теперь все детали инициализации цепочки скрыты за Фасадом. 
А клиенту достаточно создать объект фасада, передав ему компоненты приложения для работы 
с кэшем, базой данных и API: 

```php
    $currency = new CurrencyFacade($cache, $db, $api);
```
 
И можно, где требуется, внедрять зависимость **CurrencyFacadeInterface** и вызывать метод 
**getExchangeRate()**. Например:

```php
    /**
     * Client action.
     *
     * @param CurrencyFacadeInterface $currency
     */
    public function example(CurrencyFacadeInterface $currency)
    {
        // Injected facade for working with currencies.
        $rate = $currency->getExchangeRate('RUB', 'EUR');

        // ...
    }
```

Конечно, при решении данной задачи, некоторые моменты упрощены. Например, не реализована 
обработка возможных ошибок.

Для наглядности, в классе [ExampleClient](src/ExampleClient.php) реализован пример 
клиентского кода. 
